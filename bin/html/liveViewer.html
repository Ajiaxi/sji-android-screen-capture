<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>LIVE: #devInfo</title>
  <link rel="stylesheet" type="text/css" href="common.css">
  <style>
    #viewer:hover {
      border: 8px solid blue;
    }
  </style>
</head>
<body>
<div class="toolbar" style="text-align: center; width: 100%; position: fixed; top:0; height: 56px">
  <form style="white-space: nowrap; height: 27px; margin-right: 130px">
    <input type="hidden" name="device" value="#device"/>
    <input type="hidden" name="accessKey" value="#accessKey"/>
    <span style="@hideIf_masterMode">
      <button type="submit">Set</button>
      <label title="Example: 0.5, 400x600, 400x, x600, 600x400 means landscape. Note: this size maybe adjusted to 8/n of original when in fastResize mode">
        <input type="text" name="size" value="@res_size" size="10" id="viewSize"/>
      </label>
      <label title="view as landscape or portrait">
        <input type="hidden" name="orient" value="@res_orient" id="viewOrient"/>
        <input type="button" class="orient_sample @res_orient"/>
      </label>
      <label enabledIf_can_fastResize title="Android 4.0+: This mode effectively shrink image size, so cut down CPU usage. But to prevent too much alias, the result size will be auto adjusted to n/8 of original, so maybe different with requested">
        <input type="hidden" name="fastResize" value="@res_fastResize"/>
        <input type="checkbox" checkedIf_res_fastResize enabledIf_can_fastResize onclick="$(this).prev().val(this.checked)"/>fastResize
      </label>
      <label enabledIf_can_fastCapture title="Android4.2+: This mode will effectively capture screenshot only when change happens, so cut down CPU usage and network traffic">
        <input type="hidden" name="fastCapture" value="@res_fastCapture"/>
        <input type="checkbox" checkedIf_res_fastCapture enabledIf_can_fastCapture onclick="$(this).prev().val(this.checked)"/>fastCapture
      </label>
    </span>
    <span style="@showIf_masterMode">
      @res_size
      <label class="@res_fastResize" title="Android 4.0+: This mode effectively shrink image size, so cut down CPU usage. But to prevent too much alias, the result size will be auto adjusted to n/8 of original, so maybe different with requested">
        fastResize
      </label>
      <label class="@res_fastCapture" title="Android4.2+: This mode will effectively capture screenshot only when change happens, so cut down CPU usage and network traffic">
        fastCapture
      </label>
    </span>
  </form>
  <iframe name="resultIFrame"></iframe>
</div>
<div style="position: fixed; right: 0; top: 0; text-align: right; width: 130px; z-index: 99">
  <div>
    <a class="button" id="btnSaveImage" href="saveImage?device=@device&accessKey=@accessKey" target="resultIFrame" title="Save Current Image To File On Server">
      Save
    </a>
    <a href="imageViewer.html?device=@device&accessKey=@accessKey" target="images_$device">Imgs</a>
  </div>
</div>
<div style="position: fixed; right: 0; top: 56px; text-align: center; width: 130px; background-color: white; z-index: 1">
  <div>
    <button onclick="AscUtil.rotateChildLocally(document.getElementById('viewerContainer'))">Rotate Locally</button>
  </div>
  <div style="font-weight:bold; margin-top: 12px">Device Action</div>
  <div style="border: 1px solid #000000">
    <div style="margin-top: 4px">
      <a class="button" href="setOrientation?device=@device&accessKey=@accessKey&orientation=landscape" target="resultIFrame" title="Landscape (Locked)" style="border: 1px solid #000000; width: 35px; height: 15px; padding: 0; margin: 0; vertical-align: middle">&nbsp;</a>
      <a class="button" href="setOrientation?device=@device&accessKey=@accessKey&orientation=portrait" target="resultIFrame" title="Portrait (Locked)" style="border: 1px solid #000000; width: 15px; height: 35px; padding: 0; margin: 0; vertical-align: middle">&nbsp;</a>
      <a class="button" href="setOrientation?device=@device&accessKey=@accessKey&orientation=free" target="resultIFrame" title="Unlock Orientation" style="vertical-align: middle">Free</a>
    </div>
    <div style="margin-top: 12px">
      <a class="button" href="turnOnScreen?device=@device&accessKey=@accessKey" target="resultIFrame">ON</a>
      <a class="button" href="sendKey?device=@device&accessKey=@accessKey&keyCode=26" target="resultIFrame" title="Only valid for android 4.2+">On/Off</a>
    </div>
    <div style="margin-top: 8px">
      <a class="button" href="sendKey?device=@device&accessKey=@accessKey&keyCode=3" target="resultIFrame">Home</a>
      <a class="button" href="sendKey?device=@device&accessKey=@accessKey&keyCode=4" target="resultIFrame">Back</a>
      <a class="button" href="sendKey?device=@device&accessKey=@accessKey&keyCode=82" target="resultIFrame">Menu</a>
      <a class="button" href="sendKey?device=@device&accessKey=@accessKey&keyCode=187" target="resultIFrame">Apps</a>
    </div>
  </div>
  <div style="margin-top: 12px">
    <button onclick="enableAdb()">Enable ADB</button>
  </div>
</div>
<div style="text-align: center; margin-top: 56px; margin-right: 130px; position: relative; z-index: 100">
  <div id="lblLoading">loading</div>
  <div id="viewerContainer" style="display: inline-block">
    <img id="viewer" src="capture?device=@device&accessKey=@accessKey&size=@size&orient=@orient&fastCapture=@fastCapture&fastResize=@fastResize"/>
  </div>
</div>
<div style="position: fixed; right: 0; bottom: 0; width: 130px; text-align: center">
  <div style="font-weight: bold">Device Info</div>
  <div style="border: 1px solid black; max-height: 176px; overflow: auto">#devInfo</div>
</div>
<script src="jquery.js" type="text/javascript"></script>
<script src="common.js" type="text/javascript"></script>
<script>
  AscUtil.setTouchHandler(document.getElementById('viewer'), 'touch?device=@device&accessKey=@accessKey');
  $('#lblBrowserAgentStr').text('Current browser agent string: ' + navigator.userAgent);
  if (!/chrome|firefox/i.test(navigator.userAgent) && (!/safari/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent))) {
    AscUtil.loopLoadImage(document.getElementById('viewer'));
  }
  $('#lblLoading').hide();

  var $size = $('#viewSize'), $orient = $('#viewOrient');
  $size.on('change', function () {
    var match = $size.val().match(/^([^x]*)x([^x]*)$/i);
    if (match) {
      var w = Number(match[1]), h = Number(match[2]);
      if (w && h) {
        var orient = (w > h ? 'landscape' : 'portrait');
        if ($orient.val() !== orient) {
          $orient.val(orient);
          $orient.next().attr('class', orient);
        }
      }
    }
  });
  $orient.next().on('click', function () {
    var orient = ($orient.val() === 'landscape' ? 'portrait' : 'landscape');
    $orient.val(orient);
    $orient.next().attr('class', orient);
    $size.val($size.val().replace(/^([^x]*)x([^x]*)$/i, '$2x$1'));
  });

  function enableAdb() {
    AscUtil.createAdbDevice('adbBridge?device=@device&accessKey=@accessKey', function (err, conStr, connected) {
      if (err)
        alert(err);
      else
        alert(conStr + ' ' + (connected ? '(registered to local adb daemon)' : '(not registered to local adb daemon, please manually run "adb connect ' + conStr + '")'));
    });
  }

</script>
</body>
</html>